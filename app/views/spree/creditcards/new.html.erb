<% content_for :head do %>
  <%= javascript_include_tag states_path %>
<% end %>
<%= form_tag('/creditcards') do -%>
<fieldset id="payment_profile" data-hook>
  <legend><%= t(:payment_information) %></legend>
  <div data-hook="payment_method_select">
    <% @payment_methods.each do |method| %>
    <p>
      <label>
        <%= radio_button_tag "payment_profiles_attributes[][payment_method_id]", method.id, @payment_methods.count == 1 %>
        <%= t(method.name, :scope => :payment_methods, :default => method.name) %>
      </label>
    </p>
    <% end %>

    <ul id="payment-methods" data-hook>
      <% @payment_methods.each do |method| %>
        <li id="payment_method_<%= method.id %>" class="<%= 'last' if method == @payment_methods.last %>" data-hook>
          <fieldset>
            <%= render :partial => "spree/checkout/payment/#{method.method_type}_profile", :locals => { :payment_method => method } %>
          </fieldset>
        </li>
      <% end %>
    </ul>
  </div>
</fieldset>

<br class="space" />

<div class="form-buttons" data-hook="buttons">
  <%= submit_tag t(:save_profile), :class => 'button primary' %>
  <script type="text/javascript">
  $('.form-buttons[type="submit"]').click(function() {
    $(this).attr('disabled', true).removeClass('primary').addClass('disabled');
  });
  </script>
</div>

<% end -%>
